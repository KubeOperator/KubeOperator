- name: 添加父级解析记录
  lineinfile:
    path: /etc/dnsmasq.d/kubeops.dns.conf
    regexp: 'server=/{{MASTER_IP[MASTER_IP.index(".")+1:]}}'
    line: 'server=/{{MASTER_IP[MASTER_IP.index(".")+1:]}}/{{ hostvars[groups["daemon"][0]]["ansible_ssh_host"]}}'

- name: 添加泛域名解析
  lineinfile:
    path: /etc/dnsmasq.d/kubeops.dns.conf
    regexp: 'address=/{{APP_DOMAIN}}'
    line: 'address=/{{APP_DOMAIN}}/{{ hostvars[groups["master"][0]]["ansible_ssh_host"]}}'

- name: 重启生效dnsmasq
  service:
    name: dnsmasq
    state: restarted



